#DS store app

##Tο αρχειο "DS store manual" με αναλυτικες οδηγιες εγκαταστασης και τροπους χρησης της εφαρμογης θα το βρειτε εδω:
https://drive.google.com/file/d/1GdQWKsrq7fnzaa7X1gPlXyoJNG5bLqUj/view?usp=sharing


###install
This project requires **Python** and the following Python libraries installed:

- [Pymongo]
- [Flask]
- [json]
- [random]
- [datetime]


### Τρόπος Λειτουργίας

- Δημιουργία ενός docker image που συνδέεται με ένα container της MongoDB , εισαγωγή της βάσης δεδομένων DSstore που περιέχει τα collections "users" , "admins","flights","reservations" στο image.
- Εκκίνηση του Docker Image , εισαγωγή του κώδικα στο Visual Studio Code με την ονομασία app.py εκκίνηση του κώδικα με την επιλογή Flask.

### Κώδικας

#def register()
Σε αυτο το fuction το συστημα λαμβανει μεσω της μεθοδου post τα στοιχεια που εισαγει ο χρηστης στη σελιδα register.html και τα αντιστοιχιζει στις αναλογες μεταβλητες.Εξεταζει στη συνεχεια αν υπαρχει ηδη λογαριασμος με αυτα τα στοιχεια και εμφανιζει αναλογο μηνυμα .Ειδαλλως προσθετει νεο χρηστη στο συτημα μεσω της μεθοδου insert one .Κανοντας χρηση του session διατηρει τον χρηστη συνεδεμενο στο συστημα.

#def signin()
Εξεταζει αν ο χρηστης ειναι συνεδεμενος ηδη .Αν ναι τον κατευθυνει στην σελιδα user_menu.html.Αν οχι ,τοτε λαμβανει το username/email  και το password μεσω post . Ψαχνει αν υπαρχει χρηστης με email/username ιδιο με αυτο που εισηγαγε ο χρηστης με τη μεθοδο find_one .

-Αν εχει δωσει  email και το βρηκε το συστημα ,συγκρινει το password του χρηστη της βασης δομενων με το pasword που εισηγαγε.Αν ειναι ιδια στην συνεχεια εξεταζει αν ο χρηστης εχει ενεργο λογαριασμο βρισκοντας το status του χρηστη .Αν ειναι ενεργος τον κατευθυνει στo user menu,αν οχι εμφανιζεται μηνυμα που τον προτρεπει να ενεργοποιησει τον λογαριασμο του .Αν εχει δωσει λαθος password του εμφανιζει αναλογο μηνυμα.

-Αν εχει δωσει username ο χρηστης ακολουθει παρομοια διαδικασια με αυτην που ακολουθουσε αν ειχε δωσει email.

#def user_menu():
κατευθυνει τον χρηστη στη σελιδα  user_menu.html

#def activate_account()
-Το συστημα λαμβανει απο τον χρηστη μεσω του post τον κωδικο ενεργοποιησης (activationCode) και το μετατρεπει σε string ,αλλα και τον αριθμο διαβατηριου του χρηστη (passport).

-το συστημα ψαχνει στην collection users (us) χρηστη με αριθμο διαβατηριου passport και τον "αναθετει"στη μεταβλητη "passport_found"

-Αν βρεθει χρηστης το συστημα εξεταζει αν ο code ειναι ιδιος με τον κωδικο ενεργοποιησης που αντιστοιχει στο χρηστη που βρεθηκε.Αν δεν ειναι ιδιος εμφανιζει αναλογο μηνυμα .Αν ειναι ιδιο τοτε μεσω της μεθοδου update_one αλλαζει το status του χρηστη και τον κωδικο ενεργοποιησης .

-Αν δεν βρεθει χρηστης εμφανιζει το αναλογο μηνυμα .

#def deletereservation()
Απο τον χρηστη εισαγονται ο κωδικος κρατησης (ticketcoded) και το συστημα ψαχνει στην collection reservation κρατηση με αυτον τον κωδικο:
ticket_found=reservations.find_one({'ticket_code':ticketcoded})
 - Αν βρεθει τετοια κρατηση ,το συστημα αναθετει στη μετβλητη (flight_num) τον κωδικο πτησης της κρατησης  και βασει αυτης ψαχνει στη collection flights την πτηση με αυτον τον κωδικο 
 
 -Αν βρεθει τετοια πτηση αναθετει στη μεταβλητη seats_old την διαθεσιμοτητα θεσεων της πτησης και προσθετει 1 .Επειτα  με τη μεθοδο update_one κανει upadαte στη πτηση κι εμφανιζει μηνυμα επιστροφης χρηματων στην πιστωτικη καρτα  του χρηστη (credit_val)


#def flightSearch()
Ο χρηστης εισαγει στο συστημα το τοπο αναχωρησης(departU),τον προορισμο (arrivalU) και την ημερομηνια αναχωρησης(dateU).Το συστημα ψαχνει στην collection flights με τη μεθοδο find πτησεις με τα παραπανω στοιχεια και την αναθετει στη μεταβλητη  flightResult και τις καταμετρα με τη μεθοδο count_documents kai to apotesma einai to total_count.

-Αν δεν βρεθουν πτησεις με τα παραπανω κριτηρια (total_count==0) εμφανιζει αναλογο μηνυμα .

-Αν βρεθουν πτησεις με τη μεθοδο {% for flight in flights %} στο template flightsSearch.html εμφανιζονται οι αντιστοιχες πτησεις .


#myaccount()
Σε αυτο function ο χρηστης μπορει να απενεργοποιησει τον λογαριασμο του .Αν το email in session αναθετουμε στο acc_mail το email του χρηστη που ειναι στο session.Στη συνεχεια το συστημα ψαχνει στη collection users (us) τον χρηστη με email  acc_mail.

-Αν βρεθει χρηστης το συστημα δημιουργει ενα μοναδικο κωδικο με τη μεθοδο random.randint ,τον μετατρεπει σε string και τον αναθετει  στο activationCode.Επειτα κανει update στο status του χρηστη και στο activation code.Τελος τον αποσυνδεει απο το συστημα  session["email"] = None.

-Αν δεν βρεθει χρηστης εμφανιζει αναλογο μηνυμα

#def myreservations()
Κατευθυνει τον χρηστη στη σελιδα myreservations.html οπου εμφανιζεται ενα menu με τις λειτουργιες που θελει να εκτελεσει ο χρηστης σχετικα με τις κρατησεις του (ακυρωση ,εμφανιση)


#def searchByDepart()
Σε αυτο το function μπορει να αναζητησει κρατησεις βασει τοπου αναχωρησης .
Μεσω της μεθοδου post ο χρηστης εισαγει στο συστημα το τοπο αναχωρησης (departR) και το συστημα βρισκει  με τη μεθοδο find  ολες τις κρατησεις που εχουν τοπο αναχωρησης (departT) ιδιο με το departR και αν βρεθουν τις εμφανιζει .Αν οχι εμφανιζει αναλογο μηνυμα.


#def showReservationsByPrice()
Σε αυτο το function μπορει  τη πιο ακριβη και τη πιο φθηνη κρατηση .
Το συστημα βρισκει  τις κρατησεις με τη μεθοδο find  και τις ταξινομει με τη μεθοδο sort σε φθινουσα σειρα sort('price',-1) κι εμφανιζει το πρωτο για να δειξει την ακριβοτερη.Ενω για να βρει τη φθηνοτερη τις ταξινομει σε αυξουσα σειρα sort('price',1) και εμφανιζει μονο την πρωτη εγγραφη .


#def newestfirst()
Το συστημα βρισκει και ταξινομει τις κρατησει του χρηστη σε φθινουσα σειρα βασει ημερομηνιας κρατησης find().sort('dateT',-1)  και τις εμφανιζει .Αν δεν υπαρχουν κρατησεις εμφανιζει αναλογο μηνυμα.

#def oldestfirst()
Το συστημα βρισκει και ταξινομει τις κρατησεις του χρηστη σε αυξουσα σειρα βασει ημερομηνιας κρατησης find().sort('dateT',1)  και τις εμφανιζει .Αν δεν υπαρχουν κρατησεις εμφανιζει αναλογο μηνυμα.


#def reservationTicket()
Με αυτο το function ο χρηστης κανει τη κρατηση του εισητηριου του.Εισαγει στο συστημα τον κωδικο πτησης (codeT),το ονοματεπωνυμο του (nameT) τον αριθμο διαβατηριου του (passportT) και τον αριθμο της πιστωτικης του καρτας (creditT).Το συστημα ψαχνει(find_one) τον χρηστη μεσω του ονοματος του στη collection users(us)  και τη πτηση στη collectio flights .

-Αν βρεθει ο χρηστης τοτε το συστημα αναθετει το username του στο user_val.

-Στη συνεχεια αν βρεθει και πτηση γινονται οι παρακατω αναθεσεις :τιμη πτησης(price_val),διαθεσιμοτητα θεσεων(flight_val),τοπος αναχωρισης (departT),προορισμος(arrivalT),ημερομηνια πτησης(dateT),ωρα πτησης(TimeT).

-Η διαθεσιμοτητα μειωνεται κατα 1 (new_seats=flight_val-1)
και γινεται update στη συγκεκριμενη πτηηση με κωδικο πτησης (codeT).

-Δημιουργειται ενας κωδικος κωδικος κρατησης(ticketCode)
-καταχωρειται η κρατηση στη collection resarvesations

-επιστρεφεται στον χρηστη ο μοναδικος κωδικος κρατησης.

-ΑΝ δεν βρεθει πτηση ή χρηστης το συστημα εμφανιζει αναλογο μηνυμα


#def adminSignIn()
Λαμβανει το username(usernameA),email(emailA)  και το password(passwordA) μεσω post . Ψαχνει αν υπαρχει χρηστης με email ιδιο με αυτο που εισηγαγε ο χρηστης με τη μεθοδο find_one  στη collection ads(admins).

-Αν  βρεθει administritaror στη βαση , βασει του email που εδωσε ,τοτε γινοναι οι παρακατω αναθεσεις :το username (username_valA),το password(passwordcheckA),status(statusA) .To status αν ειναι flase σημαινει οτι ο administrator εισερχεται πρωτη φορα στο συστημα .

-Συγκρινει το password του administrator της βασης δεδομενων (passwordcheckA) με το password(passwordA) που εισηγαγε.Αν ειναι ιδια στην συνεχεια εξεταζει αν τοstatus ειναι true .Αν ειναι τον κατευθυνει στo admins menu,αν οχι τον κατευθυνει στη σελιδα admin_changePW .Αν εχει δωσει λαθος password του εμφανιζει αναλογο μηνυμα.

-Αν δεν βρεθει administrator στη βαση εμφανιζεται αναλογο  μηνυμα.

#def admin_changePW():
Οταν εισερχεται στο συστημα πρωτη φορ ενας administrator θα πρεπει να αλλαξει το προσωρινο password του.Αυτο κανει αυτη η function .
Εισαγονται στο συστημα το email(emailA) και το προσωρινο  password (passwordA).Το συστημα ψαχνει τον administrator στη βαση,βασει του emailA .

-Αν βρεθει  τοτε αναθετει το username του admin  που βρεθηκε στο username_valA.Αλλαζει το status σε True και κανει update στην εγγραφη που εχει usernameA==username_valA.Επειτα εισερχεται στο admins menu.

-Aν δεν βρεθει εμφανιζει αναλογο μηνυμα.


#def admin_menu():
κατευθυνει τον admin στη σελιδα  admin_menu.html

#def createadministrator()
Ενας administrator μπορει να εισαγει νεο διαχειριστει μεσω του function αυτου.
Εισαγονται τα στοιχεια του νεου διαχειριστη :email(emailA),username(usernameA),password(passwordA).
Το συστημα ψαχνει στη βαση administrators με αναλογα στοιχεια .Αν βρεθει administrator με ιδια στοιχεια 
εμφανιζεται αναλογο μηνυμα.Αλλιως γινεται εκχωρηση στη βαση δεδομενων στη colection ads(admins).


#def newFlight():
O admin εχει δυνατοτητα να δημιουργησει νεα πτηση .ΕΙσαγει στο συστημα ::τιμη πτησης(price),διαθεσιμοτητα θεσεων(seats),τοπος αναχωρισης (depart),προορισμος(arrival),ημερομηνια πτησης(datedep),ωρα πτησης(timedep) και διαρκεια πτησης(duration) .
Το συστημα δημιουργει εναν μοναδικο κωδικο πτησης(code) και καταχωρει τη πτηση στη collection flights κι εμφανιζει ενα μηνυμα επιτυχιας και τον κωδικο.



#def flightHandle()
Ο admin μπορει να αλλαξει τη τιμη μιας πτησης υποσυγκεκριμενες συνθηκες .
Εισαγει τον κωδικο πτησης (codeC),τη νεα τιμη (priceC) και αυτη η τιμη γινεται string (priceInt) .
Το συστημα ψαχνει τη πτηση στη βαση δεδομενων βασει του codeC.
-Αν βρεθει τοτε ανατιθεται στο seats_found η διαθεσιμοτητα των θεσεων της πτησης  και κανει upadete σ αυτη τη πτηση και εμφανιζει αναλογο μηνυμα.
-Αν δεν ικοανοποιουνται οι συνθηκες που αναφεραμε εμφανιζονται αναλογα μηνυματα.


#def deleteFlight()
Διαγραφη πτησης .Ο  admin μπορει να διαγραψει μια πτηση δινοντας το κωδικο της (codeC).Το συστημα ψαχνει τη πτηση .
-Αν βρεθει εξετασει αν υπαρχουν κρατησεις γι αυτη τη πτηση (if seats_found==220)αν δεν υπαρχουν τοτε τη διαγραφει με τη μεθοδο  delete_one.

-Αν υπαρχουν κρατησεις ή αν δεν βρεθει πτηση εμφανιζονται αναλογα μηνυματα .
